# apphosting.yaml

runtime: nodejs20

# Comandos para construir y ejecutar tu aplicación
run:
  # --- PASO CLAVE ---
  # Creamos dinámicamente el archivo .env.production.
  # Next.js lo leerá automáticamente durante el build.
  # Usamos 'echo' para escribir la variable que nos da App Hosting en ese archivo.
  # Las comillas simples aseguran que el JSON se trate como una sola cadena.
  - echo "NEXT_PUBLIC_FIREBASE_WEBAPP_CONFIG='$(FIREBASE_WEBAPP_CONFIG)'" > .env.production
  - npm install
  - npm run build

# Ya no necesitamos las variables de Firebase aquí, porque se manejan con el .env.production
envs:
  # EmailJS Config
  NEXT_PUBLIC_EMAILJS_SERVICE_ID: "service_fkgi13c"
  NEXT_PUBLIC_EMAILJS_TEMPLATE_ID: "template_rlnti1a"
  NEXT_PUBLIC_EMAILJS_PUBLIC_KEY: "_CSu9Vj2Xl4nxsYj8"

secrets:
  - name: FIREBASE_ADMIN_PROJECT_ID
    secret: firebase-admin-project-id
    availability:
      - BUILD
      - RUNTIME
  
  - name: FIREBASE_ADMIN_CLIENT_EMAIL
    secret: firebase-admin-client-email
    availability:
      - BUILD
      - RUNTIME

  - name: FIREBASE_ADMIN_PRIVATE_KEY
    secret: firebase-admin-private-key
    availability:
      - BUILD
      - RUNTIME
